Overview
========

This package provides a redis cache manager for Zope. It also makes
available a decorator from dogpile.cache, which can be used to cache
specific functions or methods.

Installation
============

Add `collective.rediscache` to the buildout eggs. The package supports
configuration using the Zope product configuration mechanism:

::

        <product-config collective.rediscache>
            redis_url redis://127.0.0.1:6379
            expiration_time 300
        </product-config>

You can add this snippet to the zope-conf-additional entry in your buildout,
or directly into your instance's zope.conf file, if not using buildout.

`redis_url` is the URL for the Redis service, and `expiration_time` is the
cache entry expiration time in seconds.

Cache Manager
=============

The cache manager is compatible with any cache that uses OFS.Cache, like the
standard cache managers from Plone. To use it, it's necessary to use the ZMI's
"add" menu. Usually, it should be added to the root of the Plone site. Once
you add a `Redis Cache Manager`, you can associate it with any cacheable Zope
object, using the `cache` tab in the object's ZMI view. Associated objects
will use the cache to set and get values after that.

The cache has a single editable property, `request variables`. This property
accepts a request variable name on each line. These request variables will be
used to generate the key under which this object will be stored in the cache.
By default, the only variable used is `AUTHENTICATED_USER`. This means that
a value will be stored for the same object for each user that calls it.

To invalidate cache entries, use the `invalidate` button from the object's
cache tab in the ZMI. Note that this will invalidate all stored values for
that object, even if they come from several views.

Cache Decorator
===============

The package defines a dogpile.cache region that can be used to decorate
functions and methods. This will cache the return value of the function using
a key derived from its arguments. Example:

::
  
    from collective.rediscache.cachemanager import redis_cache


    @redis_cache.cache_on_arguments()
    def some_expensive_call(x, y):
        return very_slow_function(x) + ultra_slow_function(y)

`cache_on_arguments` can include the keyword parameter `expiration_time`,
given in seconds. This expiration time  will override the general cache
expiration time configuration. The decorated function can be called normally,
but the return value will be stored in the cache and pulled from there until
it expires.

The decorator also adds a couple of useful attributes to the function. The
`invalidate` attribute invalidates the return value generated with the
arguments used:

::

    some_expensive_call.invalidate(3, 4)

The `set` attribute sets a value without calling the functions, and assigns
it to the key generated by the regular arguments.

::

    some_expensive_call.set(new_value, 3, 4)

The `original` attribute is used to call the function directly, without using
the cache:

::

    some_expensive_call.original(3, 4)

For more information on the decorator, consult the dogpile.cache documentation.
